/*
jQuery.ThreeDots.min

Author Jeremy Horn
Version 1.0.10
Date: 1/25/2009
More: http://tpgblog.com/ThreeDots/
compiled by http://yui.2clics.net/
*/

(function(e){function t(t,r){if(e.fn.ThreeDots.c_settings.allow_dangle==true){return false}var i=e(t).children("."+e.fn.ThreeDots.c_settings.e_span_class).get(0);var s=e(i).css("display");var o=n(t,r);e(i).css("display","none");var u=n(t,r);e(i).css("display",s);if(o>u){return true}else{return false}}function n(t,n){var r=typeof n;if(r=="object"||r==undefined){return e(t).height()/n.lh}else if(r=="boolean"){var s=i(e(t));return{lh:s}}}function r(t){var n;var r=e.fn.ThreeDots.c_settings.valid_delimiters;t=jQuery.trim(t);var i=-1;var s=null;var o=null;jQuery.each(r,function(e,n){if((new String(n)).length!=1||n==null){return false}var r=t.lastIndexOf(n);if(r!=-1){if(r>i){i=r;s=t.substring(i+1);o=n}}});if(i>0){return{updated_string:jQuery.trim(t.substring(0,i)),word:s,del:o}}else{return{updated_string:"",word:jQuery.trim(t),del:null}}}function i(t){e(t).append("<div id='temp_ellipsis_div' style='position:absolute; visibility:hidden'>H</div>");var n=e("#temp_ellipsis_div").height();e("#temp_ellipsis_div").remove();return n}function s(t,r,i){var s=e(r).text();var o=s;var u=e.fn.ThreeDots.c_settings.max_rows;var a,f,l,c,h;var p;if(n(t,i)<=u){return}else{p=0;curr_length=o.length;curr_middle=Math.floor((curr_length-p)/2);a=s.substring(p,p+curr_middle);f=s.substring(p+curr_middle);while(curr_middle!=0){e(r).text(a);if(n(t,i)<=u){h=Math.floor(f.length/2);l=f.substring(0,h);p=a.length;o=a+l;curr_length=o.length;e(r).text(o)}else{o=a;curr_length=o.length}curr_middle=Math.floor((curr_length-p)/2);a=s.substring(0,p+curr_middle);f=s.substring(p+curr_middle)}}}e.fn.ThreeDots=function(t){var n=this;if(typeof t=="object"||t==undefined){e.fn.ThreeDots.the_selected=this;e.fn.ThreeDots.c_settings=e.extend({},e.fn.ThreeDots.settings,t);e.fn.ThreeDots.the_selected.each(function(){curr_this=e(this);if(e(curr_this).children("."+e.fn.ThreeDots.c_settings.text_span_class).length>0){e(curr_this).attr("data-originalSpan",e(curr_this).children("."+e.fn.ThreeDots.c_settings.text_span_class).text())}});var n=e.fn.ThreeDots.update(t)}return n};e.fn.ThreeDots.update=function(i){var o,u=null;var a,f,l,c,h;var p,d;var v,m,g;if(typeof i=="object"||i==undefined){e.fn.ThreeDots.c_settings=e.extend({},e.fn.ThreeDots.settings,i);var y=e.fn.ThreeDots.c_settings.max_rows;if(y<1){return e.fn.ThreeDots.the_selected}var b=false;jQuery.each(e.fn.ThreeDots.c_settings.valid_delimiters,function(e,t){if((new String(t)).length==1){b=true}});if(b==false){return e.fn.ThreeDots.the_selected}e.fn.ThreeDots.the_selected.each(function(){o=e(this);if(e(o).children("."+e.fn.ThreeDots.c_settings.text_span_class).length==0){return true}p=e(o).children("."+e.fn.ThreeDots.c_settings.text_span_class).get(0);var i=n(o,true);var a=e(o).attr("data-originalSpan");s(o,p,i);var f=e(p).text();if((m=e(o).attr("threedots"))!=undefined){e(p).text(m);e(o).children("."+e.fn.ThreeDots.c_settings.e_span_class).remove()}v=e(p).text();if(v.length<=0){v=""}e(o).attr("threedots",a);if(n(o,i)>y){curr_ellipsis=e(o).append('<span style="white-space:nowrap" class="'+e.fn.ThreeDots.c_settings.e_span_class+'">'+e.fn.ThreeDots.c_settings.ellipsis_string+"</span>");while(n(o,i)>y){d=r(e(p).text());e(p).text(d.updated_string);u=d.word;g=d.del;if(g==null){break}}if(u!=null){var l=t(o,i);if(n(o,i)<=y-1||l||!e.fn.ThreeDots.c_settings.whole_word){v=e(p).text();if(d.del!=null){e(p).text(v+g)}if(n(o,i)>y){e(p).text(v)}else{e(p).text(e(p).text()+u);if(n(o,i)>y+1||!e.fn.ThreeDots.c_settings.whole_word||f==u||l){while(n(o,i)>y){if(e(p).text().length>0){e(p).text(e(p).text().substr(0,e(p).text().length-1))}else{break}}}}}}}if(a==e(e(o).children("."+e.fn.ThreeDots.c_settings.text_span_class).get(0)).text()){e(o).children("."+e.fn.ThreeDots.c_settings.e_span_class).remove()}else{if(e(o).children("."+e.fn.ThreeDots.c_settings.e_span_class).length>0){if(e.fn.ThreeDots.c_settings.alt_text_t){e(o).children("."+e.fn.ThreeDots.c_settings.text_span_class).attr("title",a)}if(e.fn.ThreeDots.c_settings.alt_text_e){e(o).children("."+e.fn.ThreeDots.c_settings.e_span_class).attr("title",a)}}}})}return e.fn.ThreeDots.the_selected};e.fn.ThreeDots.settings={valid_delimiters:[" ",",","."],ellipsis_string:"...",max_rows:2,text_span_class:"ellipsis_text",e_span_class:"threedots_ellipsis",whole_word:true,allow_dangle:false,alt_text_e:false,alt_text_t:false}})(jQuery)